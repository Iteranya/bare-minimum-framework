<!-- templates/edit_form.html -->
<h1>{{ "Create" if not entity_name else "Edit" }} {{ entity_type | title }}</h1>
<form method="post" action="{% if entity_name %}{{ url_for('update_entity', entity_type=entity_type, entity_name=entity_name) }}{% else %}{{ url_for('save_new_entity', entity_type=entity_type) }}{% endif %}" enctype="multipart/form-data">
  {% for field in fields %}
    <div class="field">
      <label for="{{ field.key }}">{{ field.label }}</label>
      
      {% if field.type == 'text' or field.type == 'number' %}
        <input type="{{ field.type }}" id="{{ field.key }}" name="{{ field.key }}" 
          value="{{ data.get('data', {}).get(field.key.split('.')[-1], '') }}" {% if field.required %}required{% endif %}>
      
      {% elif field.type == 'textarea' %}
        <textarea id="{{ field.key }}" name="{{ field.key }}" {% if field.required %}required{% endif %}>{{ data.get('data', {}).get(field.key.split('.')[-1], '') }}</textarea>
      
      {% elif field.type == 'select' %}
        <select id="{{ field.key }}" name="{{ field.key }}" {% if field.required %}required{% endif %}>
          {% for option in field.options %}
            <option value="{{ option }}" {% if data.get('data', {}).get(field.key.split('.')[-1]) == option %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
      
      {% elif field.type == 'file' %}
        <input type="file" id="{{ field.key }}" name="{{ field.key }}">
        {% if data.get('data', {}).get(field.key.split('.')[-1]) %}
          <img src="{{ data.get('data', {}).get(field.key.split('.')[-1]) }}" width="100">
        {% endif %}
      {% endif %}
    </div>
  {% endfor %}
  
  <button type="submit">Save</button>
  <a href="{{ url_for('entity_dashboard', entity_type=entity_type) }}">Cancel</a>
</form>